import numpy as np
from pbctools import pbc_dist, next_neighbor, molecule_recognition
from ase.io import read, write

data1 = read('100_steps_4koh.xyz', index=":")
pbc = np.loadtxt('pbc')
coords1 = np.array([frame.get_positions() for frame in data1])
atoms1 = np.array(data1[0].get_chemical_symbols())


molecules = molecule_recognition(coords1[0], atoms1, pbc)
print(molecules)
#{'HO': 4, 'K': 4, 'H2O': 92}

distances = pbc_dist(coords1, coords1, pbc)
distances.shape
#(100, 288, 288, 3)


coordsO = coords1[0][atoms1=="O"]
coordsO.shape
#(96, 3)
coordsH = coords1[0][atoms1=="H"]
coordsH.shape
#(188, 3)

indices, distances = next_neighbor(np.array([coordsO]), np.array([coordsH]), pbc)
print(indices)
# [[  0   1   2   3   4   6   9  10  12  14  17  19  21  23  24  27  28  30
#    32  34  37  39  41  43  45  46  48  51  52  55  56  58  61  62  65  66
#    69  71  73  75  76  79  81  82  84  86  88  90  92  95  96  99  49 103
#   104 107 108 110 112 114 116 119 121 122 125 126 128 131 132 135 136 138
#   141 143 145 146 149 151 153 154 156 158 160 162 164 166 168 170 173 175
#   177 179 180 182 184 187]]
# print(distances)
# [[0.9858405  0.9920111  0.9314136  0.9863206  0.9966996  1.0086311
#   0.97184247 0.9679762  0.9982032  1.0227137  0.97526175 0.9682375
#   0.9969517  0.95967865 0.9566738  0.94458157 0.96365863 0.9607076
#   0.9939579  1.0016098  0.95898336 0.96408117 0.9909743  0.9792066
#   0.98771864 0.9688401  1.0113386  0.96249586 0.9803549  0.9656944
#   0.97229224 1.0102543  1.009141   0.99075764 0.9823247  0.99398535
#   0.96370685 0.9421432  1.0147072  0.9711073  0.9797037  0.9697969
#   0.9636113  0.97003317 0.9674704  0.94179416 0.98696196 1.0102633
#   0.98547506 0.99509454 0.95883155 0.97430706 0.9828111  0.9820276
#   0.9770752  0.9794418  0.9978199  0.9683732  0.98878115 0.9430145
#   1.0340189  0.99753904 1.0204958  0.989889   0.9717043  0.96557564
#   0.97779876 0.9666859  0.9824974  0.98079133 0.9875075  0.9647944
#   0.9813219  0.9749223  1.0286719  0.95972353 1.0114303  0.99145174
#   1.0309247  1.0031132  0.98011065 0.96702176 0.98446155 0.97376937
#   0.9900845  0.9832381  1.0048091  0.9716733  1.0070044  0.94853747
#   0.9600601  0.97613543 0.9632597  0.9947116  0.9357734  0.9906035 ]]
